# 1. PostgreSQL éƒ¨ç½²
apiVersion: apps/v1
kind: Deployment
metadata:
  name: sister-db
spec:
  selector:
    matchLabels:
      app: sister-db
  template:
    metadata:
      labels:
        app: sister-db
    spec:
      containers:
      - name: db
        image: postgres:15-alpine
        env:
        - name: POSTGRES_DB
          value: sister_cms
        - name: POSTGRES_USER
          value: admin
        - name: POSTGRES_PASSWORD
          value: password123
---
# 2. PostgreSQL æœå‹™ (è®“å¾Œç«¯æ‰¾å¾—åˆ°è³‡æ–™åº«)
apiVersion: v1
kind: Service
metadata:
  name: sister-db-service
spec:
  selector:
    app: sister-db
  ports:
    - port: 5432
---
# 3. Spring Boot å¾Œç«¯éƒ¨ç½²
apiVersion: apps/v1
kind: Deployment
metadata:
  name: sister-backend
spec:
  replicas: 2 # ğŸ’¡ è·‘å…©å€‹å¯¦ä¾‹ï¼Œåˆ†æ•£é¢¨éšª
  selector:
    matchLabels:
      app: sister-backend
  template:
    metadata:
      labels:
        app: sister-backend
    spec:
      containers:
      - name: backend
        image: sister_backend:latest # ğŸ’¡ å‰›æ‰å¦³æ‰“åŒ…çš„æ˜ åƒæª”
        imagePullPolicy: Never
        env:
        - name: SPRING_DATASOURCE_URL
          value: "jdbc:postgresql://sister-db-service:5432/sister_cms"
        - name: SPRING_DATASOURCE_USERNAME
          value: "admin"
        - name: SPRING_DATASOURCE_PASSWORD
          value: "password123"
        volumeMounts:
        - name: firebase-key-volume
          mountPath: "/app/config" # ğŸ’¡ é‡‘é‘°æœƒå‡ºç¾åœ¨é€™è£¡
          readOnly: true
      volumes:
      - name: firebase-key-volume
        secret:
          secretName: firebase-key
---
# 4. å¾Œç«¯æœå‹™ (NodePort è®“å¦³èƒ½å¾é›»è…¦é€£é€²å»)
apiVersion: v1
kind: Service
metadata:
  name: sister-backend-service
spec:
  type: NodePort
  selector:
    app: sister-backend
  ports:
    - port: 8080
      targetPort: 8080
      nodePort: 30080 # ğŸ’¡ è¨ªå• http://localhost:30080